name: 'rtx - Real Tracker X'
description: 'Cross-ecosystem dependency trust scanner for secure upgrades.'
author: 'Andreas Fahl'

inputs:
  command:
    description: 'The rtx command to run (scan, pre-upgrade, report, etc.)'
    required: false
    default: 'scan'
  path:
    description: 'The path to the directory to scan.'
    required: false
    default: '.'
  format:
    description: 'The output format for the report (table, json, html).'
    required: false
    default: 'table'
  output:
    description: 'The file path to save the report to.'
    required: false
  github_token:
    description: 'GitHub token for accessing advisories.'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install rtx
      shell: bash
      run: pip install rtx-trust

    - name: Run rtx
      shell: bash
      env:
        INPUT_COMMAND: ${{ inputs.command }}
        INPUT_PATH: ${{ inputs.path }}
        INPUT_FORMAT: ${{ inputs.format }}
        INPUT_OUTPUT: ${{ inputs.output }}
        GITHUB_TOKEN: ${{ inputs.github_token }}
      run: |
        rtx_args="$INPUT_COMMAND --path $INPUT_PATH --format $INPUT_FORMAT"
        if [[ -n "$INPUT_OUTPUT" ]]; then
          rtx_args="$rtx_args --output $INPUT_OUTPUT"
        fi
        
        echo "Running: rtx $rtx_args"
        
        rtx $rtx_args
